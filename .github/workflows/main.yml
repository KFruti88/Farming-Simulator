# Farming Simulator Live Sync Workflow
# Mandate: Hyper-Realism & Accuracy | Zero-Fake Policy
# Source: G-Portal FTP (176.57.165.81)
# Goal: Maintain 1:1 synchronization for slots 1-5
# Author: werewolf3788

name: G-Portal Live Sync

on:
  schedule:
    - cron: '*/30 * * * *' # Synchronizes every 30 minutes to ensure live accuracy
  workflow_dispatch:      # Allows Kevin or Ray to trigger a manual sync at any time

jobs:
  sync-gportal:
    runs-on: ubuntu-latest
    steps:
      - name: üõ∞Ô∏è Checkout Repository
        uses: actions/checkout@v4

      - name: üöú Download Live Data from G-Portal
        run: |
          sudo apt-get update && sudo apt-get install -y lftp
          mkdir -p dedicated_server
          lftp -c "open -u ${{ secrets.FTP_USERNAME }},${{ secrets.FTP_PASSWORD }} ${{ secrets.FTP_SERVER }}; \
          mirror --verbose --parallel=2 /savegame1 ./saved-game-1; \
          mirror --verbose --parallel=2 /savegame2 ./saved-game-2; \
          mirror --verbose --parallel=2 /savegame3 ./saved-game-3; \
          mirror --verbose --parallel=2 /savegame4 ./saved-game-4; \
          mirror --verbose --parallel=2 /savegame5 ./saved-game-5"
          wget -O dedicated_server/dedicated-server-stats.xml "http://176.57.165.81:8080/feed/dedicated-server-stats.xml?code=DIaoyx8jutkGtlDr"
          wget -O dedicated_server/map.jpg "http://176.57.165.81:8080/feed/dedicated-server-stats-map.jpg?code=DIaoyx8jutkGtlDr&quality=60&size=512"

      - name:  Commit & Push Live Data
        run: |
          git config --global user.name "Werewolf-Automation"
          git config --global user.email "kevin@ourflora.com"
          git add saved-game-1/ saved-game-2/ saved-game-3/ saved-game-4/ saved-game-5/ dedicated_server/
          # Only commit if actual game changes (money, hours, etc.) are detected
          git commit -m "Live Update: All 5 Save Slots Synchronized from G-Portal" || exit 0
          git push
