<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>618 CREW | REVERSE SYNC v2.32</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --kevin-orange: #f97316;
            --bg-tactical: #020617;
            --panel-bg: rgba(26, 29, 33, 0.95);
        }

        /* REVERSE COLOR THEME FOR LIVE SLOT */
        .live-reverse {
            background: var(--kevin-orange) !important;
            color: #000 !important;
            border: 2px solid #fff !important;
        }

        .live-reverse select, .live-reverse h1, .live-reverse h2 {
            color: #000 !important;
        }

        body { background: var(--bg-tactical); color: #e2e8f0; font-family: 'Inter', sans-serif; padding: 20px; }

        /* 90% WIDTH MANDATE [cite: 2026-01-26] */
        .hq-wrapper {
            width: 90%; margin: auto;
            background: var(--panel-bg);
            border: 2px solid var(--kevin-orange);
            border-radius: 12px; padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
        }

        header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 20px; }

        .box-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 30px; }
        .scroll-box { background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.08); border-radius: 10px; padding: 20px; height: 600px; overflow-y: auto; }

        /* DATA CARDS [cite: 2026-02-13] */
        .data-card { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid var(--kevin-orange); }
        .mono { font-family: monospace; font-size: 12px; }
        
        @media (max-width: 1200px) { .box-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div id="mainWrapper" class="hq-wrapper">
    <header id="dynamicHeader">
        <div class="branding">
            <h1 style="font-size: 24px; font-weight: 900; text-transform: uppercase;">618 Crew Mission Control</h1>
            <div id="liveMapBadge" style="font-size: 10px; font-weight: 900; margin-top: 5px;">SCANNING...</div>
        </div>
        <select id="slotSelector" style="background:#000; color:#fff; border:1px solid var(--kevin-orange); padding:10px; font-weight:900;">
            </select>
    </header>

    <div class="box-grid">
        <div class="scroll-box" id="box-farmland"><h3>ðŸŒ¾ FARMLAND</h3><div class="content"></div></div>
        <div class="scroll-box" id="box-missions"><h3>ðŸ“‘ CONTRACTS</h3><div class="content"></div></div>
        <div class="scroll-box" id="box-fleet"><h3>ðŸšœ FLEET</h3><div class="content"></div></div>
    </div>
</div>

<script>
/**
 * 618 REVERSE-SYNC ENGINE v2.32
 * MANDATE: Full Detail | No Snippets | Zero-Fake | No KG [cite: 2026-01-26]
 */

const GITHUB_ROOT = "https://raw.githubusercontent.com/KFruti88/Farming-Simulator/main";
const GPORTAL_FEED = "http://176.57.165.81:8080/feed/dedicated-server-stats.xml?code=DIaoyx8jutkGtlDr";

const MAPS = {
    1: "ELMCREEK", 2: "BIG FLATS TEXAS", 3: "ZIELONKA", 4: "HAUT-BEYLERON",
    5: "LAND OF ITALY", 6: "SILVERRUN FOREST", 7: "CALMSDEN FARM", 8: "ERLENGRAT",
    9: "OLD STREAM FARM", 10: "FRANKENMUTH", 11: "NO MAN'S LAND", 12: "STONE VALLEY",
    13: "BLOOMFIELD", 14: "GRIFFIN INDIANA", 15: "IOWA PLAINS", 16: "BUCKS COUNTY",
    17: "ALMA MISSOURI", 18: "OXYGENDAVID", 19: "WESTBRIDGE HILLS", 20: "FIELD OF DREAMS"
};

document.addEventListener('DOMContentLoaded', async () => {
    const selector = document.getElementById('slotSelector');
    const liveMap = await fetchLiveMap();
    const liveSlot = Object.keys(MAPS).find(key => MAPS[key] === liveMap.toUpperCase()) || 2;

    for (let i = 1; i <= 20; i++) {
        const opt = document.createElement('option');
        opt.value = i;
        const isLive = i == liveSlot;
        opt.innerText = `SLOT ${i}: ${MAPS[i]} ${isLive ? '[LIVE]' : ''}`;
        if (isLive) opt.style.background = "#f97316";
        selector.appendChild(opt);
    }

    selector.value = liveSlot;
    updateTheme(liveSlot, liveSlot); // Set initial theme [cite: 2026-02-13]
    runDrill(liveSlot);

    selector.addEventListener('change', (e) => {
        updateTheme(e.target.value, liveSlot);
        runDrill(e.target.value);
    });
});

function updateTheme(selected, live) {
    const wrapper = document.getElementById('mainWrapper');
    const badge = document.getElementById('liveMapBadge');
    if (selected == live) {
        wrapper.classList.add('live-reverse');
        badge.innerText = `[LIVE] SERVER OPERATING ON: ${MAPS[live]}`;
    } else {
        wrapper.classList.remove('live-reverse');
        badge.innerText = `VIEWING ARCHIVE: ${MAPS[selected]}`;
    }
}

async function runDrill(slot) {
    const path = `${GITHUB_ROOT}/saved-game-${slot}`;
    const [fml, pre, fld] = await Promise.all([
        fetchXML(`${path}/farmland.xml`), fetchXML(`${path}/precisionFarming.xml`), fetchXML(`${path}/fields.xml`)
    ]);

    if (fml) {
        const owned = Array.from(fml.getElementsByTagName("farmland")).filter(f => f.getAttribute("farmId") === "1");
        const pNodes = Array.from(pre?.getElementsByTagName("field") || []);
        document.querySelector('#box-farmland .content').innerHTML = owned.map(l => {
            const p = pNodes.find(n => n.getAttribute("id") === l.getAttribute("id"));
            // NO KG: US Standard lbs/ac [cite: 2026-01-26]
            const lbs = (parseFloat(p?.getAttribute("nitrogenValue") || 0) * 2.204).toFixed(0);
            return `<div class="data-card"><strong>FIELD ${l.getAttribute("id")}</strong><br><span class="mono">${lbs} lbs/ac</span></div>`;
        }).join('');
    }
}

async function fetchLiveMap() {
    try {
        const res = await fetch(GPORTAL_FEED + `?t=${Date.now()}`);
        const xml = new DOMParser().parseFromString(await res.text(), "text/xml");
        return xml.getElementsByTagName("Server")[0]?.getAttribute("mapName") || "Unknown";
    } catch (e) { return "Unknown"; }
}

async function fetchXML(url) {
    try {
        const res = await fetch(url + `?t=${Date.now()}`);
        return res.ok ? new DOMParser().parseFromString(await res.text(), "text/xml") : null;
    } catch (e) { return null; }
}
</script>
</body>
</html>
