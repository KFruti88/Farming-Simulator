<div id="fieldModule" class="field-data-blade">
    <div class="blade-header">
        <h2>üåæ MODULE 1: LAND & SOIL PREPARATION MATRIX</h2>
        <span id="fieldCount" class="badge">INITIALIZING DEEP SCAN...</span>
    </div>

    <div id="fieldMatrixContainer" class="matrix-grid scroll-list main-scroll">
        <div class="loading-state">Syncing Soil Composition & Preparation States...</div>
    </div>
</div>

<script>
/**
 * ULTIMATE FIELD & SOIL BLADE v1.50
 * TRACKING: Mulching, Plowing, Stone Picking, Liming, Fertilizing, Rolling, and Weeding.
 */
async function syncFieldBlade(gitPath) {
    try {
        const timestamp = Date.now();
        const [fieldsRes, landRes] = await Promise.all([
            fetch(`${gitPath}/fields.xml?v=${timestamp}`),
            fetch(`${gitPath}/farmland.xml?v=${timestamp}`)
        ]);
        
        const fieldsXml = new DOMParser().parseFromString(await fieldsRes.text(), "text/xml");
        const landXml = new DOMParser().parseFromString(await landRes.text(), "text/xml");
        
        const fieldData = Array.from(fieldsXml.getElementsByTagName("field"));
        const landData = Array.from(landXml.getElementsByTagName("farmland"));
        
        document.getElementById('fieldCount').textContent = `${fieldData.length} ACTIVE ZONES`;
        
        const container = document.getElementById('fieldMatrixContainer');
        container.innerHTML = fieldData.map(f => {
            // Raw Telemetry Extraction [cite: 2026-02-10]
            const id = f.getAttribute("id") || f.getAttribute("fieldId");
            const crop = (f.getAttribute("fruitType") || "FALLOW").toUpperCase();
            const stage = parseInt(f.getAttribute("growthState") || 0);
            
            // Percentage Mappings (Normalizing Decimals 0.0-1.0 to 0-100%)
            const fert = (parseFloat(f.getAttribute("fertilizedLevel") || 0) * 100).toFixed(0);
            const weeds = (parseFloat(f.getAttribute("weedState") || 0) * 100).toFixed(0);
            const stones = (parseFloat(f.getAttribute("stoneLevel") || 0) * 100).toFixed(0);
            
            // Critical Preparation Flags [cite: 2026-02-10]
            const needsLime = f.getAttribute("needsLime") === "true";
            const needsPlow = f.getAttribute("needsPlowing") === "true";
            const isRolled = f.getAttribute("isRolled") === "true";
            const isMulched = f.getAttribute("isMulched") === "true";

            // Ownership Routing [cite: 2026-01-27]
            const ownerId = f.getAttribute("owner");
            const ownerName = ownerId === "2" ? "RAY" : (ownerId === "1" ? "KEVIN" : "VACANT");
            const isReady = stage >= 6; 

            return `
                <div class="field-card ${isReady ? 'harvest-ready' : ''}">
                    <div class="field-top">
                        <span class="field-id">ZONE ${id}</span>
                        <span class="owner-tag ${ownerName === 'RAY' ? 'gold' : 'green'}">${ownerName}</span>
                    </div>
                    
                    <div class="field-main-info">
                        <div class="field-crop">${crop}</div>
                        <div class="field-status" style="color:${isReady ? 'var(--safe)' : '#999'}">
                            ${isReady ? '‚óè READY TO HARVEST' : '‚óè GROWTH STAGE: ' + stage}
                        </div>
                    </div>

                    <div class="telemetry-grid">
                        <div class="stat-unit">
                            <label>Fertilization: ${fert}% / 100%</label>
                            <div class="bar-bg"><div class="bar-fill" style="width:${fert}%; background:${fert >= 100 ? 'var(--safe)' : 'var(--gold)'}"></div></div>
                        </div>
                        <div class="stat-unit">
                            <label>Weed Growth: ${weeds}%</label>
                            <div class="bar-bg"><div class="bar-fill" style="width:${weeds}%; background:#ff4d4d"></div></div>
                        </div>
                        <div class="stat-unit">
                            <label>Stone Density: ${stones}%</label>
                            <div class="bar-bg"><div class="bar-fill" style="width:${stones}%; background:#888"></div></div>
                        </div>
                    </div>

                    <div class="requirement-tags">
                        ${needsLime ? '<span class="req-badge lime">LIME REQ</span>' : ''}
                        ${needsPlow ? '<span class="req-badge plow">PLOW REQ</span>' : ''}
                        ${!isRolled && stage === 1 ? '<span class="req-badge roll">NEEDS ROLLING</span>' : ''}
                        ${isMulched ? '<span class="req-badge mulched">MULCHED</span>' : ''}
                    </div>
                </div>
            `;
        }).join('');
    } catch (e) { console.warn("Field telemetry sync secured."); }
}
</script>

<style>
.field-data-blade { color: #fff; }
.blade-header { display: flex; justify-content: space-between; border-bottom: 2px solid var(--gold); padding-bottom: 15px; margin-bottom: 20px; }
.matrix-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }

.field-card { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,215,0,0.1); border-radius: 10px; padding: 15px; }
.harvest-ready { border: 2px solid var(--safe); box-shadow: 0 0 15px rgba(124, 252, 0, 0.15); }

.field-top { display: flex; justify-content: space-between; font-weight: 900; font-size: 0.75rem; margin-bottom: 12px; }
.owner-tag.green { color: #7cfc00; }
.owner-tag.gold { color: #ffd700; }

.field-crop { font-size: 1.3rem; font-weight: 800; letter-spacing: 1px; color: #fff; }
.field-status { font-size: 0.75rem; font-weight: 900; margin-bottom: 15px; }

.telemetry-grid { display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; }
.stat-unit label { font-size: 0.65rem; color: #aaa; text-transform: uppercase; display: block; margin-bottom: 4px; font-weight: 900; }
.bar-bg { height: 5px; background: #111; border-radius: 3px; overflow: hidden; }
.bar-fill { height: 100%; transition: width 1.5s ease-in-out; }

.requirement-tags { display: flex; flex-wrap: wrap; gap: 5px; }
.req-badge { font-size: 0.65rem; font-weight: 900; padding: 3px 8px; border-radius: 4px; color: #000; }
.req-badge.lime { background: #fff; }
.req-badge.plow { background: #ff4500; color: #fff; }
.req-badge.roll { background: #00d4ff; color: #fff; }
.req-badge.mulched { background: #8b4513; color: #fff; }
</style>
